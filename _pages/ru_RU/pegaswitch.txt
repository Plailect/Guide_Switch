---
title: "PegaSwitch"
---

{% include toc title="Table of Contents" %}

### Required Reading

PegaSwitch is a developer-focused exploitation toolkit for the Switch developed by ReSwitched. It is compatible with firmware versions 1.0.0 - 3.0.0.

The toolkit uses a combination of vulnerabilities to take over the WebKit-based browser, giving the user a shell which can be used to read / write memory, call native functions, and otherwise explore the functionality of the Switch.

Note that the current homebrew exploit has the side-effect of corrupting your device's Mii Database. Хоть это и безвредно для самого устройства, все Mii, созданные пользователем, будут потеряны.
{: .notice--warning}

### Что понадобится

* Поддерживаемая операционная система
  + MacOS and most linux distributions are supported
  + Windows is best supported using a [Windows Subsystem for Linux](https://docs.microsoft.com/en-us/windows/wsl/install-win10) distribution
* The [git](https://git-scm.com/) version control system
* The [Node.JS](https://nodejs.org/en/download/package-manager/) JavaScript runtime (current release)

### Instructions

#### Section I - Network Configuration

PegaSwitch works by hosting a [captive portal](https://en.wikipedia.org/wiki/Captive_portal) using DNS redirection.

For this to work, your device must be able to connect to your PC over the network.

1. Ensure no other applications are bound to UDP port 53 or TCP ports 80 and 8100
  + WSL: look at the "Listening Ports" section of the "Network" tab in `resmon.exe`
  + Linux / MacOS: view the output of `sudo netstat -tulpn`
1. Ensure your firewall does not block incoming connections to any of these ports

#### Section II - Running PegaSwitch

~~~ bash
# clone the repository
git clone https://github.com/reswitched/pegaswitch

# install dependencies
cd pegaswitch
npm install

# start PegaSwitch
# Windows users: omit the 'sudo'
sudo node start.js
~~~

#### Section III - DNS Configuration

Note that these DNS servers will need to be set on each network you connect your device to for it to be able to trigger the exploit.
{: .notice--info}

1. Get your PC's IP address with `ifconfig` (or `ipconfig` on windows)
1. Launch System Settings on your device
1. Перейдите в `Интернет` -> `Интернет-настройки`
1. Выберите вашу текущую сеть
  + Она обозначена зелёной галочкой рядом с сетью
1. Выберите "Изменить настройки"
1. Измените "Настройки DNS" на "Вручную"
1. Set "Primary DNS" and "Secondary DNS" to your PC's IP address
1. Сохраните настройки сети
1. Return to `Internet Settings`

#### Section IV - Initial Connection

1. Перейдите в `Интернет` -> `Интернет-настройки`
1. Выберите вашу текущую сеть
1. Выберите "Подключиться к этой сети"
1. Если соединение с DNS прошло успешно, вы увидите сообщение "Регистрация необходима для использования этой сети."
1. Выберите "Далее"
1. Будет загружена веб-страница PegaSwitch
1. If the exploit was successful, you will now have a PegaSwitch shell connected to your console

#### Section V - Alternative Browser Applets (Optional)

There are actually [multiple](http://switchbrew.org/index.php?title=Internet_Browser#Browser_Applets) internet browsers on the Switch, and any of them can be used to trigger the browser exploit.

While we used the connection test browser applet to initially trigger the exploit, it may be more convenient in the future to use another browser applet.

Triggering the browser exploit using either of these methods will have the same effect as triggering the exploit through the Connection Test method we used before.

##### Форма входа в eShop

Для этого метода требуется вторая учётная запись на устройстве. Не соединяйте её с Nintendo Account.

1. Запустите Nintendo eShop
1. Выберите вторую учётную запись
1. Выберите "Войти и присоединить"
1. Запустится браузер-апплет

##### Форма обновления игры

Для этого метода на главном экране должна присутствовать хотя бы одна игра.

Обратите внимание: если вы не подключены к корректным DNS серверам, этот метод *обновит* вашу консоль. Это опасно!
{: .notice--danger}

1. Нажмите (+) на любой выделенной в меню игре
1. Во вкладке "Обновление программы" выберите "Через Интернет"
1. Запустится браузер-апплет

___

You can now easily connect to your device using the PegaSwitch environment.
{: .notice--success}

For debugging purposes, you may want to [enable extra error info](troubleshooting#enable-extra-error-info).
{: .notice--info}

### Return to [Homebrew Development](homebrew-development)
{: .notice--primary}
