---
title: "PegaSwitch"
---

{% include toc title="Содержание" %}

### Обязательно к прочтению

PegaSwitch - это программный комплекс для взаимодействия со Switch, ориентированный на разработчиков и разрабатываемый командой ReSwitched. Он совместим с версиями прошивки 1.0.0 - 3.0.0.

Комплекс использует комбинацию уязвимостей браузера на базе WebKit, предоставляя пользователю оболочку, которой можно воспользоваться для чтения / записи памяти, вызова нативных функций и в целом пользоваться функционалом Switch.

Обратите внимание, что текущий эксплойт для хоумбрю имеет побочный эффект, при котором база данных Mii повреждается. Хоть это и безвредно для самого устройства, все Mii, созданные пользователем, будут потеряны.
{: .notice--warning}

### Что понадобится

* Поддерживаемая операционная система
  + MacOS и большинство дистрибутивов Linux поддерживаются
  + Windows лучше поддерживается с использованием [Windows Subsystem for Linux](https://docs.microsoft.com/en-us/windows/wsl/install-win10) (англ.)
* Система контроля версий [git](https://git-scm.com/)
* [Node.JS](https://nodejs.org/en/download/package-manager/) (текущая версия)

### Инструкция

#### Часть I - Настройка сети

PegaSwitch работает при помощи размещения [Captive portal](https://en.wikipedia.org/wiki/Captive_portal) (англ.), используя переадресацию DNS.

Для успешной работы ваша консоль должна иметь доступ к вашему компьютеру через сеть.

1. Убедитесь, что никакие приложения не привязаны к UDP порту 53 или TCP портам 80 и 8100
  + WSL: смотрите секцию "Порты прослушивания" на вкладке "Сеть" в Мониторе ресурсов `resmon.exe`
  + Linux / MacOS: смотрите вывод `sudo netstat -tulpn`
1. Убедитесь, что файервол не блокирует входящие подключения на этих портах

#### Часть II - Запуск PegaSwitch

~~~ bash
# клонируем репозиторий
git clone https://github.com/reswitched/pegaswitch

# установка зависимостей
cd pegaswitch
npm install

# запускаем PegaSwitch
# пользователям Windows: пропустите 'sudo'
sudo node start.js
~~~

#### Часть III - Конфигурация DNS

Обратите внимание, что адреса этих DNS серверов должны быть настроены для каждой сети, к которой вы подключаете свою консоль, чтобы эксплойт сработал.
{: .notice--info}

1. Узнайте IP-адрес вашего компьютера с помощью `ifconfig` (или `ipconfig` на Windows)
1. Откройте Системные настройки на вашей консоли
1. Перейдите в `Интернет` -> `Интернет-настройки`
1. Выберите вашу текущую сеть
  + Она обозначена зелёной галочкой рядом с сетью
1. Выберите "Изменить настройки"
1. Измените "Настройки DNS" на "Вручную"
1. Измените значения полей "Первичный DNS" и "Вторичный DNS" на IP-адрес вашего компьютера
1. Сохраните настройки сети
1. Return to `Internet Settings`

#### Section IV - Initial Connection

1. Перейдите в `Интернет` -> `Интернет-настройки`
1. Выберите вашу текущую сеть
1. Выберите "Подключиться к этой сети"
1. Если соединение с DNS прошло успешно, вы увидите сообщение "Регистрация необходима для использования этой сети."
1. Выберите "Далее"
1. Будет загружена веб-страница PegaSwitch
1. If the exploit was successful, you will now have a PegaSwitch shell connected to your console

#### Section V - Alternative Browser Applets (Optional)

There are actually [multiple](http://switchbrew.org/index.php?title=Internet_Browser#Browser_Applets) internet browsers on the Switch, and any of them can be used to trigger the browser exploit.

While we used the connection test browser applet to initially trigger the exploit, it may be more convenient in the future to use another browser applet.

Triggering the browser exploit using either of these methods will have the same effect as triggering the exploit through the Connection Test method we used before.

##### Форма входа в eShop

Для этого метода требуется вторая учётная запись на устройстве. Не соединяйте её с Nintendo Account.

1. Запустите Nintendo eShop
1. Выберите вторую учётную запись
1. Выберите "Войти и присоединить"
1. Запустится браузер-апплет

##### Форма обновления игры

Для этого метода на главном экране должна присутствовать хотя бы одна игра.

Обратите внимание: если вы не подключены к корректным DNS серверам, этот метод *обновит* вашу консоль. Это опасно!
{: .notice--danger}

1. Нажмите (+) на любой выделенной в меню игре
1. Во вкладке "Обновление программы" выберите "Через Интернет"
1. Запустится браузер-апплет

___

You can now easily connect to your device using the PegaSwitch environment.
{: .notice--success}

For debugging purposes, you may want to [enable extra error info](troubleshooting#enable-extra-error-info).
{: .notice--info}

### Return to [Homebrew Development](homebrew-development)
{: .notice--primary}
